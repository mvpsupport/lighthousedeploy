{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/uiDefinition.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "1.0.0",
  "parameters": {
    "basics": [
      {
        "name": "offerName",
        "type": "Microsoft.Common.TextBox",
        "label": "Delegation name",
        "defaultValue": "Xcelocloud Lighthouse Delegation",
        "constraints": {
          "required": true,
          "minLength": 3,
          "maxLength": 64
        }
      },
      {
        "name": "offerDescription",
        "type": "Microsoft.Common.TextBox",
        "label": "Delegation description",
        "defaultValue": "Delegated Azure management via Azure Lighthouse",
        "constraints": {
          "required": true,
          "minLength": 3,
          "maxLength": 256
        }
      }
    ],
    "steps": [
      {
        "name": "partnerInfo",
        "label": "Partner information",
        "elements": [
          {
            "name": "infoBox",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Azure Lighthouse enables cross-tenant management. You'll delegate access from this subscription to a partner tenant, allowing specified users or groups in the partner tenant to manage resources here."
            }
          },
          {
            "name": "tenantIdLabel",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Partner Tenant ID"
            }
          },
          {
            "name": "managedByTenantIdDisplay",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "fc6f8abc-0ae4-4406-abeb-4eb1ca6e07a1",
              "link": {
                "label": "",
                "uri": ""
              }
            }
          },
          {
            "name": "tenantIdNote",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "This delegation is pre-configured for the partner tenant shown above. If you need to delegate to a different partner, please contact your service provider."
            }
          }
        ]
      },
      {
        "name": "permissions",
        "label": "Access & Permissions",
        "elements": [
          {
            "name": "authorizationsSection",
            "type": "Microsoft.Common.Section",
            "label": "Select roles for partner access",
            "elements": [
              {
                "name": "authorizationInfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "The partner groups listed below are pre-configured. You can select which Azure role each group should receive for managing your subscription."
                }
              },
              {
                "name": "supportTeamLabel",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Partner Support Team",
                  "style": "Bold"
                }
              },
              {
                "name": "supportTeamRole",
                "type": "Microsoft.Common.DropDown",
                "label": "Role for Partner Support Team",
                "toolTip": "Select the Azure RBAC role to grant to the Partner Support Team",
                "defaultValue": "Support Request Contributor",
                "constraints": {
                  "required": true,
                  "allowedValues": [
                    {
                      "label": "Support Request Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/cfd33db0-3dd1-45e3-aa9d-cdbdf3b6f24e"
                    },
                    {
                      "label": "Reader",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7"
                    },
                    {
                      "label": "Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                    },
                    {
                      "label": "Monitoring Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa"
                    }
                  ]
                }
              },
              {
                "name": "engineeringTeamLabel",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Partner Engineering Team",
                  "style": "Bold"
                }
              },
              {
                "name": "engineeringTeamRole",
                "type": "Microsoft.Common.DropDown",
                "label": "Role for Partner Engineering Team",
                "toolTip": "Select the Azure RBAC role to grant to the Partner Engineering Team",
                "defaultValue": "Support Request Contributor",
                "constraints": {
                  "required": true,
                  "allowedValues": [
                    {
                      "label": "Support Request Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/cfd33db0-3dd1-45e3-aa9d-cdbdf3b6f24e"
                    },
                    {
                      "label": "Reader",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7"
                    },
                    {
                      "label": "Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                    },
                    {
                      "label": "Owner",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635"
                    },
                    {
                      "label": "Virtual Machine Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c"
                    },
                    {
                      "label": "Network Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7"
                    },
                    {
                      "label": "Storage Account Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab"
                    },
                    {
                      "label": "Backup Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b"
                    },
                    {
                      "label": "Monitoring Contributor",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa"
                    },
                    {
                      "label": "Security Admin",
                      "value": "/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd"
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      {
        "name": "review",
        "label": "Review + Create",
        "elements": [
          {
            "name": "reviewSection",
            "type": "Microsoft.Common.Section",
            "label": "Summary",
            "elements": [
              {
                "name": "summaryInfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "Review your Lighthouse delegation settings. Once deployed, the partner tenant will have access to manage resources in this subscription according to the roles you've assigned."
                }
              },
              {
                "name": "delegationName",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "[concat('Delegation: ', basics('offerName'))]"
                }
              },
              {
                "name": "tenantId",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Partner Tenant: fc6f8abc-0ae4-4406-abeb-4eb1ca6e07a1"
                }
              },
              {
                "name": "authCount",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Authorizations configured: 2"
                }
              },
              {
                "name": "auth1",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "[concat('  • Partner Support Team: ', steps('permissions').authorizationsSection.supportTeamRole.label)]"
                }
              },
              {
                "name": "auth2",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "[concat('  • Partner Engineering Team: ', steps('permissions').authorizationsSection.engineeringTeamRole.label)]"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "offerName": "[basics('offerName')]",
      "offerDescription": "[basics('offerDescription')]",
      "managedByTenantId": "fc6f8abc-0ae4-4406-abeb-4eb1ca6e07a1",
      "authorizations": [
        {
          "principalId": "ac16bf33-cebb-44ea-b8d2-30650cf35bd2",
          "principalIdDisplayName": "Partner Support Team",
          "roleDefinitionId": "[steps('permissions').authorizationsSection.supportTeamRole]"
        },
        {
          "principalId": "3a829362-01c3-4bda-b6a2-fcbbb32169d0",
          "principalIdDisplayName": "Partner Engineering Team",
          "roleDefinitionId": "[steps('permissions').authorizationsSection.engineeringTeamRole]"
        }
      ]
    }
  }
}
